<!--
  ~ Copyright (c) 2024 Nicolas PICON
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
  ~ documentation files (the "Software"), to deal in the Software without restriction, including without limitation
  ~ the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,
  ~ and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all copies or substantial portions
  ~ of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED
  ~ TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
  ~ THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF
  ~ CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  ~ DEALINGS IN THE SOFTWARE.
  -->
<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    lang="en">
<head>
    <title>N2RSS</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/n2rss.css}"/>
</head>
<body>
<div class="header">
    <img th:src="@{/images/logo.png}" alt="N2RSS Logo" width="100">
    <h1>Newsletters to RSS</h1>
    <p class="sub-title">Stay informed with your favorite newsletters as RSS feeds</p>
    <p class="project-description">
        Newsletter are great to keep informed on subjects, but it can be hard to keep track of the articles they
        provide.
        This is where <em>Newsletters To RSS</em> can be helpful!
        We provide RSS feeds for a selection of newsletters; each time a new publication is received,
        the articles will be extracted and published in the corresponding feed.
    </p>
</div>
<div class="container">
    <table>
        <thead>
        <tr>
            <th>Newsletter</th>
            <th>RSS feed</th>
            <th>Publications</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="newsletter : ${newsletters}">
            <td>
                <a th:href="${newsletter.websiteUrl}"
                   th:text="${newsletter.title}"
                   target="_blank"/>
            </td>
            <td>
                <a th:href="${requestUrl + 'rss/' + newsletter.code}"
                   target="_blank">
                    RSS Feed
                </a>
            </td>
            <td>
                <span class="publication-count">
                    <span th:text="${newsletter.publicationCount}"/> publications<br/>
                </span>
                <span class="publication-start">
                    since <span th:text="${newsletter.startingDate}"/>
                </span>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<form id="newsletterForm" action="/send-request" method="post">
    <p>
        You can request we add new RSS feed by submitting a request in the form below
    </p>
    <label for="newsletterUrl">Enter newsletter URL</label>
    <input
        type="text" id="newsletterUrl" name="newsletterUrl"
        placeholder="https://androidweekly.net/" required>

    <!-- reCaptcha -->
    <div class="g-recaptcha"
         th:data-sitekey="${reCaptchaSiteKey}"
         data-callback="enableSubmit"
         th:if="${reCaptchaEnabled}">
    </div>

    <input type="submit" id="sendRequest" value="Send request"
           th:disabled="${reCaptchaEnabled} ? 'disabled' : null">
</form>
<div id="message" class="alert" style="display: none"></div>

<a href="https://github.com/nicopico-dev/n2rss" target="_blank">
    <img
        src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149"
        class="github-banner"
        alt="Fork me on GitHub"
        loading="lazy"
        decoding="async"
        data-recalc-dims="1"/>
</a>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script>
    // noinspection JSUnusedGlobalSymbols
    function enableSubmit() {
        document.getElementById("sendRequest").disabled = false;
    }

    function configureForm() {
        document.getElementById('newsletterForm')
            .addEventListener('submit', function (event) {
                event.preventDefault();
                let message = document.getElementById('message');
                fetch(
                    "/send-request",
                    {
                        method: 'POST',
                        body: new FormData(this)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("HTTP error " + response.status);
                        }
                        message.textContent = "Successfully subscribed!";
                        message.classList.add('alert-success');
                    })
                    .catch(() => {
                        message.textContent = "There was an error subscribing.";
                        message.classList.add('alert-danger');
                    })
                    .finally(() => {
                        message.style.display = "block";
                    });
            });
    }

    configureForm()
</script>
</body>
</html>
